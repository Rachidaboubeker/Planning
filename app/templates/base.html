<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Planning Restaurant{% endblock %}</title>

    <!-- ‚úÖ CSS unifi√© refactoris√© -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">

    <!-- Font Awesome pour les ic√¥nes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Navigation modernis√©e -->
    <nav class="app-header">
        <div class="header-content">
            <div class="header-brand">
                <i class="fas fa-utensils"></i>
                <span>Planning Restaurant</span>
            </div>

            <div class="header-actions">
                <a href="{{ url_for('main.index') }}" class="btn {{ 'btn-primary' if request.endpoint == 'main.index' else 'btn-outline' }}">
                    <i class="fas fa-calendar-week"></i> Planning
                </a>
                <a href="{{ url_for('main.employees') }}" class="btn {{ 'btn-primary' if request.endpoint == 'main.employees' else 'btn-outline' }}">
                    <i class="fas fa-users"></i> √âquipiers
                </a>
                <button class="btn btn-outline" onclick="showStats()">
                    <i class="fas fa-chart-bar"></i> Statistiques
                </button>
            </div>
        </div>
    </nav>

    <!-- Contenu principal -->
    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- ‚úÖ Configuration Flask pour la nouvelle architecture -->
    <script id="flask-config" type="application/json">
        {
            "API_BASE": "/api",
            "TIME_SLOT_GRANULARITY": {{ config.get('TIME_SLOT_GRANULARITY', 60) }},
            "HOURS_RANGE": {{ config.get('HOURS_RANGE', [8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2]) | tojson }},
            "DAYS_OF_WEEK": {{ config.get('DAYS_OF_WEEK', ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche']) | tojson }},
            "EMPLOYEE_TYPES": {{ config.get('EMPLOYEE_TYPES', {
                'cuisinier': {'color': '#74b9ff', 'name': 'Cuisinier'},
                'serveur': {'color': '#00b894', 'name': 'Serveur/se'},
                'barman': {'color': '#fdcb6e', 'name': 'Barman'},
                'manager': {'color': '#a29bfe', 'name': 'Manager'},
                'aide': {'color': '#6c5ce7', 'name': 'Aide de cuisine'},
                'commis': {'color': '#fd79a8', 'name': 'Commis'}
            }) | tojson }}
        }
    </script>

    <!-- ‚úÖ Zone des modals (pour la nouvelle architecture) -->
    <div id="modalContainer"></div>

    <!-- ‚úÖ Zone des notifications (pour la nouvelle architecture) -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- ‚úÖ JavaScript refactoris√© - ORDRE CRITIQUE -->
    {% block javascript %}
    <!-- 1. Core (fondations) -->
    <script src="{{ url_for('static', filename='js/core/config.js') }}"></script>
    <script src="{{ url_for('static', filename='js/core/state.js') }}"></script>
    <script src="{{ url_for('static', filename='js/utils/layout-fix.js') }}"></script>
    <script src="{{ url_for('static', filename='js/core/events.js') }}"></script>

    <!-- 2. Utilitaires -->
    <script src="{{ url_for('static', filename='js/utils/time.js') }}"></script>
    <script src="{{ url_for('static', filename='js/utils/validation.js') }}"></script>

    <!-- 3. Managers -->
    <script src="{{ url_for('static', filename='js/managers/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/managers/ui.js') }}"></script>
    <script src="{{ url_for('static', filename='js/managers/planning.js') }}"></script>
    <script src="{{ url_for('static', filename='js/managers/drag-drop.js') }}"></script>

    <!-- 4. Composants -->
    <script src="{{ url_for('static', filename='js/components/modal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/notification.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/legend.js') }}"></script>

    <!-- 5. App principal -->
    <!-- Dans la section scripts, avant app.js -->
    <script src="{{ url_for('static', filename='js/utils/employee-shift-mapper.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>

    <!-- üêõ DEBUG - Uniquement en d√©veloppement -->
    {% if config.DEBUG %}
    <script src="{{ url_for('static', filename='js/utils/auto-repair.js') }}"></script>
    {% endif %}

    {% endblock %}
    {% block extra_js %}{% endblock %}

    <!-- ‚úÖ Styles de transition pour √©viter le FOUC -->
    <style>
        /* Styles de base pour √©viter le flash de contenu non styl√© */
        body.loading .main-content {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        body.initialized .main-content {
            opacity: 1;
        }

        /* Loader simple pendant l'initialisation */
        .app-loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            text-align: center;
        }

        .app-loader i {
            font-size: 2rem;
            color: #667eea;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        body.initialized .app-loader {
            display: none;
        }
    </style>

    <!-- ‚úÖ Loader pendant l'initialisation -->
    <div class="app-loader">
        <i class="fas fa-spinner"></i>
        <p>Chargement de Planning Restaurant...</p>
    </div>

    <script>
        // ‚úÖ Marquer comme en cours de chargement
        document.body.classList.add('loading');

        // ‚úÖ Fonction globale pour les statistiques (compatibilit√©)
        function showStats() {
            if (window.UIManager && typeof window.UIManager.showStatsModal === 'function') {
                window.UIManager.showStatsModal();
            } else if (window.NotificationManager) {
                window.NotificationManager.info('Statistiques', 'Fonctionnalit√© en d√©veloppement');
            } else {
                alert('Statistiques - Fonctionnalit√© en d√©veloppement');
            }
        }
    </script>
</body>
</html>